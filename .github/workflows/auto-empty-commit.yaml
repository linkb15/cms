name: Auto Empty Commit

permissions:
  contents: write

jobs:
  empty_commit:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Get the Latest Commit Branch
        id: get_branch
        run: echo "branch=$(git rev-parse --abbrev-ref HEAD)" >> $GITHUB_ENV

      - name: Check GitHub Actor
        id: check_actor
        continue-on-error: true
        run: |
          ALLOWED_ACTORS=(
            "vincentri"
          )

          if [[ ! " ${ALLOWED_ACTORS[@]} " =~ " ${{ github.actor }} " ]]; then
            echo "Actor ${{ github.actor }} is not in the allowed list"
            exit 1
          fi

      - name: Create Empty Commit
        if: success() && steps.check_actor.outcome == 'success'
        run: |
          git config --local user.name "linkb15"
          git config --local user.email "borris.wiria@gmail.com"
          git commit --allow-empty -m "Auto commit after push"
          git push origin ${{ env.branch }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
